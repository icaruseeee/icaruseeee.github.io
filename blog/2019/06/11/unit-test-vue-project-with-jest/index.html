<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用jest对vue项目进行单元测试 | ICARUSEEEE&#39;s</title>
    <meta name="description" content="Just playing around">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
  <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.e7b6cd04.css" as="style"><link rel="preload" href="/assets/js/app.7bd0a9df.js" as="script"><link rel="preload" href="/assets/js/3.18fce9f8.js" as="script"><link rel="preload" href="/assets/js/1.1bfc0bf1.js" as="script"><link rel="preload" href="/assets/js/10.5bd1626f.js" as="script"><link rel="prefetch" href="/assets/js/11.3800256b.js"><link rel="prefetch" href="/assets/js/4.d5fbe4b0.js"><link rel="prefetch" href="/assets/js/5.2f30224d.js"><link rel="prefetch" href="/assets/js/6.e96fdcac.js"><link rel="prefetch" href="/assets/js/7.5b97e125.js"><link rel="prefetch" href="/assets/js/8.03b1ca99.js"><link rel="prefetch" href="/assets/js/9.77094c95.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e7b6cd04.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ICARUSEEEE's</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">Blog</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">Blog</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>使用jest对vue项目进行单元测试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019/06/11/unit-test-vue-project-with-jest/#一、基本测试方法（vue组件）" class="sidebar-link">一、基本测试方法（Vue组件）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/2019/06/11/unit-test-vue-project-with-jest/#_1-1-mount-shallowmount-渲染方式的区别" class="sidebar-link">1.1 mount/shallowMount 渲染方式的区别</a></li><li class="sidebar-sub-header"><a href="/blog/2019/06/11/unit-test-vue-project-with-jest/#_1-2-props-methods等" class="sidebar-link">1.2 props/methods等</a></li><li class="sidebar-sub-header"><a href="/blog/2019/06/11/unit-test-vue-project-with-jest/#_1-3-data、用户交互的测试" class="sidebar-link">1.3 data、用户交互的测试</a></li><li class="sidebar-sub-header"><a href="/blog/2019/06/11/unit-test-vue-project-with-jest/#_1-4-计算属性的测试" class="sidebar-link">1.4 计算属性的测试</a></li><li class="sidebar-sub-header"><a href="/blog/2019/06/11/unit-test-vue-project-with-jest/#_1-5-事件发布的测试" class="sidebar-link">1.5 事件发布的测试</a></li></ul></li><li><a href="/blog/2019/06/11/unit-test-vue-project-with-jest/#二、基本测试方法（vuex）" class="sidebar-link">二、基本测试方法（Vuex）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/2019/06/11/unit-test-vue-project-with-jest/#_2-1-测试mutations" class="sidebar-link">2.1 测试mutations</a></li><li class="sidebar-sub-header"><a href="/blog/2019/06/11/unit-test-vue-project-with-jest/#_2-2-测试actions" class="sidebar-link">2.2 测试actions</a></li></ul></li><li><a href="/blog/2019/06/11/unit-test-vue-project-with-jest/#三、eastblue-中的简单应用" class="sidebar-link">三、Eastblue 中的简单应用</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用jest对vue项目进行单元测试"><a href="#使用jest对vue项目进行单元测试" class="header-anchor">#</a> 使用jest对vue项目进行单元测试</h1> <h2 id="一、基本测试方法（vue组件）"><a href="#一、基本测试方法（vue组件）" class="header-anchor">#</a> 一、基本测试方法（Vue组件）</h2> <h3 id="_1-1-mount-shallowmount-渲染方式的区别"><a href="#_1-1-mount-shallowmount-渲染方式的区别" class="header-anchor">#</a> 1.1 mount/shallowMount 渲染方式的区别</h3> <p>vue-test-utils提供了两种渲染方式，可以根据测试目标选择不同的渲染方式。一般在测试层级较高的组件（如CenterContentArea）时尽量使用shallowMount。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mount<span class="token punctuation">,</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">'../../example/HelloWorld'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'test difference between mount &amp; shallowMount'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'shallowRender'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 浅渲染</span>
        <span class="token keyword">const</span> shallowUnit <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">)</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>shallowUnit<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'completeRender'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 完整渲染</span>
        <span class="token keyword">const</span> mountUnit <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">)</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>mountUnit<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>以下是执行后获得的快照，可以看到如果使用shallowMount子组件会被渲染成存根的形式。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">test difference between mount &amp; shallowMount completeRender 1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;div
  class=&quot;hello&quot;
&gt;  
  &lt;p&gt;
     hello world 
  &lt;/p&gt;
   
  &lt;!----&gt;
   
  &lt;div&gt;
     test jest 
  &lt;/div&gt;
&lt;/div&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

exports<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">test difference between mount &amp; shallowMount shallowRender 1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;div
  class=&quot;hello&quot;
&gt;
  &lt;p&gt;
     hello world 
  &lt;/p&gt;
   
  &lt;!----&gt;
   
  &lt;message-stub /&gt;
&lt;/div&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

</code></pre></div><h3 id="_1-2-props-methods等"><a href="#_1-2-props-methods等" class="header-anchor">#</a> 1.2 props/methods等</h3> <p>props、methods等可以归为一类，在 vue 实例中类型为对象。 可以在渲染前传入值，也可以使用vue-test-utils的wrapper的相关方法（如setProps）改变。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">'../../example/HelloWorld'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;props test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'设置props'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 渲染组件时传入</span>
        <span class="token keyword">const</span> shallowUnit <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            propsData<span class="token operator">:</span> <span class="token punctuation">{</span>
                propsData<span class="token operator">:</span> <span class="token string">'test props'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">// 使用vue-test-utils提供的api修改</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>shallowUnit<span class="token punctuation">.</span><span class="token function">props</span><span class="token punctuation">(</span><span class="token string">'propsData'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'test props'</span><span class="token punctuation">)</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>shallowUnit<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'test props'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 通过props传入的值进行权限控制</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'权限控制'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> shallowUnit <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>HelloWorld<span class="token punctuation">)</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>shallowUnit<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'adminspan'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

        shallowUnit<span class="token punctuation">.</span><span class="token function">setProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isAdmin<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>shallowUnit<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'adminspan'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_1-3-data、用户交互的测试"><a href="#_1-3-data、用户交互的测试" class="header-anchor">#</a> 1.3 data、用户交互的测试</h3> <p>data被渲染后成为挂载在vm上的属性，测试挂载的属性即可。</p> <p>对于用户交互的测试，需要先用选择器选中操作的dom对象，再模拟用户交互。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> DataTest <span class="token keyword">from</span> <span class="token string">'../../example/DataTest'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;data test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'测试用户交互'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> shallowUnit <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>DataTest<span class="token punctuation">)</span>
        <span class="token keyword">const</span> textInput <span class="token operator">=</span> shallowUnit<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input[type=&quot;text&quot;]'</span><span class="token punctuation">)</span>
        <span class="token comment">// 使用选择器选择操作的目标</span>
        <span class="token comment">// 一个选择器可以是一个 CSS 选择器、一个 Vue 组件或是一个查找选项对象。</span>
        
        textInput<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">'first set value'</span><span class="token punctuation">)</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>shallowUnit<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'first set value'</span><span class="token punctuation">)</span>

        <span class="token comment">// 另一种写法</span>
        textInput<span class="token punctuation">.</span>element<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'next set value'</span>
        textInput<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>shallowUnit<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'next set value'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_1-4-计算属性的测试"><a href="#_1-4-计算属性的测试" class="header-anchor">#</a> 1.4 计算属性的测试</h3> <p>其实和props的测试类似，改变条件后测试获得的结果（DOM节点 或者 [Component].computed[target]）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> ComputedNumbers <span class="token keyword">from</span> <span class="token string">'../../example/ComputedNumbers'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;computed test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'测试计算属性'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 传入even: true 返回[1-10]之间的偶数</span>
        <span class="token comment">// 传入even: false 返回[1-10]之间的奇数</span>
        <span class="token keyword">const</span> shallowUnit <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>ComputedNumbers<span class="token punctuation">)</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>shallowUnit<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'1 3 5 7 9'</span><span class="token punctuation">)</span>

        shallowUnit<span class="token punctuation">.</span><span class="token function">setProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span> even<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>shallowUnit<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'2 4 6 8 10'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'另一种方式'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>ComputedNumbers<span class="token punctuation">.</span>computed<span class="token punctuation">.</span><span class="token function">numbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'1 3 5 7 9'</span><span class="token punctuation">)</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>ComputedNumbers<span class="token punctuation">.</span>computed<span class="token punctuation">.</span><span class="token function">numbers</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span> even<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'2 4 6 8 10'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_1-5-事件发布的测试"><a href="#_1-5-事件发布的测试" class="header-anchor">#</a> 1.5 事件发布的测试</h3> <p>测试事件发布，需要操作vm执行vm.$emit()</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> EmitTest <span class="token keyword">from</span> <span class="token string">'../../example/EmitTest'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/test-utils&quot;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;测试事件发布&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;emits an event with two arguments&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>EmitTest<span class="token punctuation">)</span>
        <span class="token comment">// 发布事件</span>
        wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;myEvent&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 或者用methods中写好的方法 wrapper.vm.emitEvent()</span>
        
        <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>myEvent<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="二、基本测试方法（vuex）"><a href="#二、基本测试方法（vuex）" class="header-anchor">#</a> 二、基本测试方法（Vuex）</h2> <p>store中都是一些比较分离的状态和方法，所以我们可以单独对store进行测试。</p> <h3 id="_2-1-测试mutations"><a href="#_2-1-测试mutations" class="header-anchor">#</a> 2.1 测试mutations</h3> <p>mutation本质上是一个函数， 但是我们需要通过store.commit来提交一个mutation。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> storeConfig <span class="token keyword">from</span> <span class="token string">'../../../storeConfig'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mutationTypes <span class="token keyword">as</span> mTypes<span class="token punctuation">,</span> actionTypes <span class="token keyword">as</span> aTypes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/appConstant'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createLocalVue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">import</span> deepCopy <span class="token keyword">from</span> <span class="token string">'deep-copy'</span>

<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>
<span class="token comment">// 在本地创建一个vue环境，启用vuex</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;mutation test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> store 
    <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在每项测试前初始化一个store</span>
        store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token function">deepCopy</span><span class="token punctuation">(</span>storeConfig<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;test mutations&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 通过commit提交一个mutation</span>
        store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span>mTypes<span class="token punctuation">.</span><span class="token constant">INFO_SELE_GAME_CHANGE</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> gameId<span class="token operator">:</span> <span class="token number">127</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 检查store中的状态是否改变</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>curGameId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-2-测试actions"><a href="#_2-2-测试actions" class="header-anchor">#</a> 2.2 测试actions</h3> <p>与mutation类似，但是区别在于actions中存在异步操作。eastblue中用到了axios库。在使用到这个库的地方需要自行mock axios (或者直接返回一个Promise对象)。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//...重复代码</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> asynchornous <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./AsyncFunc'</span>
<span class="token comment">// asynchornous 是一个异步函数，返回一个Promise对象</span>

<span class="token keyword">const</span> localVue <span class="token operator">=</span> <span class="token function">createLocalVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
localVue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token comment">// 对异步函数的测试</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'async function test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'works with async/await'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        expect<span class="token punctuation">.</span><span class="token function">assertions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//确保至少有一个断言被调用，否则测试失败</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">asynchornous</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'测试 async/await'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 在eastblue项目中，我们使用回调函数来处理异步函数的返回</span>
<span class="token comment">// 这时我们需要将回调用一个function包起来， 加上done()方法</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;action test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> store 
    <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token function">deepCopy</span><span class="token punctuation">(</span>storeConfig<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;test actions&quot;</span><span class="token punctuation">,</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">666</span><span class="token punctuation">)</span>
            <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>aTypes<span class="token punctuation">.</span><span class="token constant">AJAX_SDK</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            params<span class="token operator">:</span> <span class="token punctuation">{</span> gameId<span class="token operator">:</span> <span class="token number">666</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            success<span class="token operator">:</span> callback
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="三、eastblue-中的简单应用"><a href="#三、eastblue-中的简单应用" class="header-anchor">#</a> 三、Eastblue 中的简单应用</h2> <p>暂不对外</p> <p>Jest Api 文档： <a href="https://jestjs.io/docs/en/api" target="_blank" rel="noopener noreferrer">Jest Api 文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Vue-test-utils文档：<a href="https://vue-test-utils.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">Vue-test-utils文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Vue-test-handbook: <a href="https://lmiller1990.github.io/vue-testing-handbook/" target="_blank" rel="noopener noreferrer">Vue-test-handbook<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/11/2019, 4:22:10 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7bd0a9df.js" defer></script><script src="/assets/js/3.18fce9f8.js" defer></script><script src="/assets/js/1.1bfc0bf1.js" defer></script><script src="/assets/js/10.5bd1626f.js" defer></script>
  </body>
</html>
